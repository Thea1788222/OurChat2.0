# OurChat2.0 聊天室页面结构与 JSP 职责划分

## 一、页面总体布局

```
---------------------------------------
|          顶栏 Header                |
|-------------------------------------|
|   左侧聊天窗口      |   右侧用户列表  |
|--------------------|----------------|
| 聊天内容区          | 在线人数显示   |
|                    | 在线用户列表   |
|                    | 离线用户列表   |
|                    | 系统提示区     |
|--------------------|----------------|
| 聊天输入区          |                |
---------------------------------------
```

---

## 二、页面各区域及数据来源

### 1️⃣ 顶栏 Header

| 内容     | 数据来源 | 说明                 |
| ------ | ---- | ------------------ |
| 昵称     | JSP  | 通过 EL 渲染当前登录用户昵称   |
| 用户 ID  | JSP  | EL 渲染              |
| 退出登录按钮 | JSP  | 点击触发 LogoutServlet |

**说明**：

* 顶栏只在初次渲染时由 JSP 输出
* 不需要 JS 动态更新，除非用户信息发生变化（可忽略）

---

### 2️⃣ 左侧聊天窗口

#### (1) 聊天内容区（消息列表）

| 内容     | 数据来源           | 说明                                                 |
| ------ | -------------- | -------------------------------------------------- |
| 历史消息   | JSP            | 初次进入聊天室时，Servlet 查询 `ChatMessageDao` 返回全部消息，JSP 渲染 |
| 新消息    | JS + WebSocket | 前端通过 WebSocket 接收新消息，动态追加到聊天区                      |
| 昵称颜色   | JS             | 根据在线状态和“我”字段动态渲染（红/绿/灰）                            |
| 消息可见对象 | JS             | 前端直接显示 `toNickname`                                |
| 发送时间   | JSP / JS       | 历史消息由 JSP 渲染，新消息由 JS 动态渲染                          |

#### (2) 聊天输入区

| 内容      | 数据来源             | 说明                                 |
| ------- | ---------------- | ---------------------------------- |
| 可见对象下拉框 | JSP 初次渲染 + JS 更新 | JSP 输出用户列表基础信息，后续在线/离线用户变化通过 JS 更新 |
| 消息内容输入框 | JSP              | 纯 HTML `<textarea>`                |
| 发送按钮    | JSP              | 触发 JS WebSocket 发送消息               |

---

### 3️⃣ 右侧用户列表窗口

| 区域     | 数据来源 | 说明                               |
| ------ | ---- | -------------------------------- |
| 在线人数   | JS   | WebSocket 推送最新在线人数               |
| 在线用户列表 | JS   | WebSocket 推送，动态渲染昵称绿色            |
| 离线用户列表 | JS   | WebSocket 推送，动态渲染昵称灰色            |
| 系统提示区  | JS   | WebSocket 推送最新上线/下线消息，仅显示一条，动态更新 |

**说明**：

* 用户列表和系统提示区完全依赖 JS + WebSocket
* JSP 仅可渲染初始状态（可为空或数据库快照）
* JS 根据消息和在线状态刷新 DOM

---

### 4️⃣ 数据来源总结表

| 数据内容        | 初次渲染方式 | 动态更新方式                |
| ----------- | ------ | --------------------- |
| 当前用户昵称、ID   | JSP    | -                     |
| 历史聊天消息      | JSP    | JS + WebSocket（新消息追加） |
| 消息发送内容      | JSP    | JS                    |
| 消息可见对象      | JSP    | JS                    |
| 在线人数        | -      | JS + WebSocket        |
| 在线用户列表      | -      | JS + WebSocket        |
| 离线用户列表      | -      | JS + WebSocket        |
| 系统提示（上线/下线） | -      | JS + WebSocket        |

---

### 5️⃣ 页面职责划分原则

1. **JSP**：

   * 只负责初次页面渲染
   * 输出静态 HTML + EL/JSTL 渲染历史数据
   * 不处理动态实时数据

2. **JS / WebSocket**：

   * 聊天消息追加
   * 用户列表动态刷新
   * 系统消息提示更新
   * 输入事件（发送消息、选择可见对象）

3. **分工明确**：

   * JSP → 负责“静态和初始状态”
   * JS → 负责“动态和实时状态”
