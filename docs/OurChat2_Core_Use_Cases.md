# OurChat2.0 核心用例清单

## 一、用户相关

1. **用户注册**

   * 用户提供昵称、邮箱、密码
   * 系统生成唯一用户 ID 并保存用户信息
   * 邮箱必须唯一，否则注册失败

2. **用户登录**

   * 用户通过邮箱和密码登录
   * 系统校验账号和密码
   * 登录成功后生成 Session
   * 已登录用户禁止再次登录（单端登录限制）

3. **用户登出**

   * 用户点击“退出登录”按钮主动登出
   * 系统清理 Session 和 WebSocket 连接
   * 更新在线状态，推送系统消息给其他用户

4. **用户关闭浏览器或意外断开**

   * 浏览器关闭或断开连接
   * Session 超时或 WebSocket onClose 回调触发下线处理
   * 更新在线状态，推送系统消息给其他用户
   * 可存在一定延时，不要求毫秒级实时性

---

## 二、聊天相关

1. **发送群聊消息**

   * 用户选择“全员可见”
   * 用户输入文本消息并发送
   * 系统记录消息（数据库）
   * 系统通过 WebSocket 推送消息给所有在线用户
   * 离线用户消息存储，登录后可查看

2. **发送私聊消息**

   * 用户选择某个指定用户作为接收对象
   * 用户输入文本消息并发送
   * 系统记录消息（数据库）
   * 如果接收用户在线，通过 WebSocket 推送
   * 如果接收用户离线，仅存储数据库，登录后可查看

3. **接收聊天消息**

   * 在线用户实时接收群聊或私聊消息
   * 消息显示发送人、内容、可见对象、发送时间
   * 当前登录用户昵称显示红色，其他用户在线绿色，离线灰色

4. **查看历史消息**

   * 用户登录进入聊天室后
   * 系统加载全部历史聊天消息（群聊 + 私聊）
   * 消息显示格式同上

---

## 三、系统消息相关

1. **用户上线通知**

   * 用户成功登录或重连后
   * 系统生成上线消息并记录
   * 通过 WebSocket 推送给其他在线用户
   * 前端仅显示最新一条系统消息

2. **用户下线通知**

   * 用户主动登出或断开
   * 系统生成下线消息并记录
   * 通过 WebSocket 推送给其他在线用户
   * 前端仅显示最新一条系统消息

---

## 四、用户列表管理

1. **显示在线用户**

   * 统计在线人数
   * 列表显示所有在线用户昵称（绿色）

2. **显示离线用户**

   * 列表显示离线用户昵称（灰色）

3. **动态更新用户状态**

   * 用户上线或下线时，在线列表和离线列表实时更新
   * 系统消息区显示最新一条上线/下线提示

---

## 五、页面访问控制

1. **禁止未登录用户访问聊天室**

   * 通过过滤器或统一入口拦截未登录请求
   * 重定向到登录页

2. **登录状态维护**

   * Session + WebSocket 维护登录状态
   * 单端登录，重复登录会使旧会话失效

